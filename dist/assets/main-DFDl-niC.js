import"./style-uri7tF9p-B_2mDeed.js";/* empty css                         */const l="http://localhost/projectGrupoBikemia/src/php";document.addEventListener("DOMContentLoaded",()=>{m(),u(),g()});function m(){document.querySelectorAll("[data-modal]").forEach(o=>{o.addEventListener("click",e=>{e.preventDefault();const a=o.getAttribute("data-modal");i(a)})}),document.querySelectorAll(".modal .close").forEach(o=>{o.addEventListener("click",()=>c(o.closest(".modal").id))}),document.querySelectorAll(".modal").forEach(o=>{o.addEventListener("click",e=>{e.target===o&&c(o.id)})})}function i(o){const e=document.getElementById(o);e&&(document.body.classList.add("modal-open"),e.classList.add("active"))}function c(o){const e=document.getElementById(o);if(e){document.body.classList.remove("modal-open"),e.classList.remove("active");const a=e.querySelector("form");a&&a.reset()}}function u(){const o=document.getElementById("cadastroForm"),e=document.getElementById("loginForm");o&&o.addEventListener("submit",async a=>{a.preventDefault();const n=new FormData(o);try{const t=await(await fetch(`${l}/cadastro.php`,{method:"POST",body:n})).text();console.log("Resposta bruta:",t);const s=JSON.parse(t);alert(s.message),s.success&&(c("cadastroModal"),i("loginModal"))}catch(r){console.error("Erro ao interpretar JSON:",r),alert("Erro inesperado no cadastro")}}),e&&e.addEventListener("submit",async a=>{a.preventDefault();const n={usuario:document.getElementById("loginUsuario").value.trim(),senha:document.getElementById("loginSenha").value};try{const t=await(await fetch(`${l}/login.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();alert(t.message),t.success&&(localStorage.setItem("sessao_token",t.token),localStorage.setItem("usuarioLogado",JSON.stringify(t.usuario)),c("loginModal"),d(t.usuario),i("bemVindoModal"))}catch(r){console.error("Erro no login:",r),alert("Erro inesperado ao fazer login")}})}function d(o=null){const e=o||JSON.parse(localStorage.getItem("usuarioLogado")),a=document.querySelector("#menu-principal");if(!a)return;if(a.querySelectorAll('[data-modal="loginModal"], [data-modal="cadastroModal"]').forEach(t=>{t&&t.parentElement&&t.parentElement.remove()}),a.querySelectorAll(".usuario-logado").forEach(t=>t.parentElement.remove()),!e){const t=document.createElement("li");t.innerHTML='<a href="#" data-modal="loginModal" class="botao">Entrar</a>',a.appendChild(t);const s=document.createElement("li");s.innerHTML='<a href="#" data-modal="cadastroModal" class="botao destaque">Cadastrar</a>',a.appendChild(s),m();return}const n=e!=null&&e.apelido&&e.apelido.trim()!==""?e.apelido:e.nome,r=document.createElement("li");r.innerHTML=`
  <span class="usuario-logado">Olá, <strong>${n}</strong>!</span>
  <a href="#" class="botao destaque" id="logoutBtn">Sair</a>
`,a.appendChild(r),document.getElementById("logoutBtn").addEventListener("click",async t=>{t.preventDefault(),await f()})}async function g(){const o=localStorage.getItem("sessao_token");if(o)try{const a=await(await fetch(`${l}/verificar_sessao.php`,{method:"GET",headers:{Authorization:o}})).json();a.success?d(a.usuario):(localStorage.removeItem("sessao_token"),localStorage.removeItem("usuarioLogado"),d())}catch(e){console.error("Erro ao verificar sessão:",e),localStorage.removeItem("sessao_token"),localStorage.removeItem("usuarioLogado")}}async function f(){const o=localStorage.getItem("sessao_token");if(!o){localStorage.removeItem("usuarioLogado"),location.reload();return}try{await fetch(`${l}/logout.php`,{method:"POST",headers:{Authorization:o}})}catch(e){console.error("Erro ao fazer logout:",e)}finally{localStorage.removeItem("sessao_token"),localStorage.removeItem("usuarioLogado"),location.reload()}}
