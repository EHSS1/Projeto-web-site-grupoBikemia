(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function o(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerPolicy&&(t.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?t.credentials="include":a.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(a){if(a.ep)return;a.ep=!0;const t=o(a);fetch(a.href,t)}})();const s="http://localhost/projectGrupoBikemia/src/php";document.addEventListener("DOMContentLoaded",()=>{u(),m(),g()});function u(){document.querySelectorAll("[data-modal]").forEach(e=>{e.addEventListener("click",o=>{o.preventDefault();const r=e.getAttribute("data-modal");c(r)})}),document.querySelectorAll(".modal .close").forEach(e=>{e.addEventListener("click",()=>l(e.closest(".modal").id))}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",o=>{o.target===e&&l(e.id)})})}function c(e){const o=document.getElementById(e);o&&(document.body.classList.add("modal-open"),o.classList.add("active"))}function l(e){const o=document.getElementById(e);if(o){document.body.classList.remove("modal-open"),o.classList.remove("active");const r=o.querySelector("form");r&&r.reset()}}function m(){const e=document.getElementById("cadastroForm"),o=document.getElementById("loginForm");e&&e.addEventListener("submit",async r=>{r.preventDefault();const a=new FormData(e);try{const t=await(await fetch(`${s}/cadastro.php`,{method:"POST",body:a})).text();console.log("Resposta bruta:",t);const n=JSON.parse(t);alert(n.message),n.success&&(l("cadastroModal"),c("loginModal"))}catch(t){console.error("Erro ao interpretar JSON:",t),alert("Erro inesperado no cadastro")}}),o&&o.addEventListener("submit",async r=>{r.preventDefault();const a={usuario:document.getElementById("loginUsuario").value.trim(),senha:document.getElementById("loginSenha").value};try{const t=await(await fetch(`${s}/login.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();alert(t.message),t.success&&(localStorage.setItem("sessao_token",t.token),localStorage.setItem("usuarioLogado",JSON.stringify(t.usuario)),l("loginModal"),i(t.usuario),c("bemVindoModal"))}catch(t){console.error("Erro no login:",t),alert("Erro inesperado ao fazer login")}})}function i(e=null){const o=e||JSON.parse(localStorage.getItem("usuarioLogado")),r=document.querySelector("#menu-principal");if(!r)return;if(r.querySelectorAll('[data-modal="loginModal"], [data-modal="cadastroModal"]').forEach(n=>{n&&n.parentElement&&n.parentElement.remove()}),r.querySelectorAll(".usuario-logado").forEach(n=>n.parentElement.remove()),!o){const n=document.createElement("li");n.innerHTML='<a href="#" data-modal="loginModal" class="botao">Entrar</a>',r.appendChild(n);const d=document.createElement("li");d.innerHTML='<a href="#" data-modal="cadastroModal" class="botao destaque">Cadastrar</a>',r.appendChild(d),u();return}const a=o!=null&&o.apelido&&o.apelido.trim()!==""?o.apelido:o.nome,t=document.createElement("li");t.innerHTML=`
  <span class="usuario-logado">Olá, <strong>${a}</strong>!</span>
  <a href="#" class="botao destaque" id="logoutBtn">Sair</a>
`,r.appendChild(t),document.getElementById("logoutBtn").addEventListener("click",async n=>{n.preventDefault(),await f()})}async function g(){const e=localStorage.getItem("sessao_token");if(e)try{const o=await(await fetch(`${s}/verificar_sessao.php`,{method:"GET",headers:{Authorization:e}})).json();o.success?i(o.usuario):(localStorage.removeItem("sessao_token"),localStorage.removeItem("usuarioLogado"),i())}catch(o){console.error("Erro ao verificar sessão:",o),localStorage.removeItem("sessao_token"),localStorage.removeItem("usuarioLogado")}}async function f(){const e=localStorage.getItem("sessao_token");if(!e){localStorage.removeItem("usuarioLogado"),location.reload();return}try{await fetch(`${s}/logout.php`,{method:"POST",headers:{Authorization:e}})}catch(o){console.error("Erro ao fazer logout:",o)}finally{localStorage.removeItem("sessao_token"),localStorage.removeItem("usuarioLogado"),location.reload()}}
