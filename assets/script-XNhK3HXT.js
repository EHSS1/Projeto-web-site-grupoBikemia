(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const e of a)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function r(a){const e={};return a.integrity&&(e.integrity=a.integrity),a.referrerPolicy&&(e.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?e.credentials="include":a.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(a){if(a.ep)return;a.ep=!0;const e=r(a);fetch(a.href,e)}})();const c="http://localhost/projectGrupoBikemia/src/php";document.addEventListener("DOMContentLoaded",()=>{u(),m(),f()});function u(){document.querySelectorAll("[data-modal]").forEach(t=>{t.addEventListener("click",o=>{o.preventDefault();const r=t.getAttribute("data-modal");i(r)})}),document.querySelectorAll(".modal .close").forEach(t=>{t.addEventListener("click",()=>l(t.closest(".modal").id))}),document.querySelectorAll(".modal").forEach(t=>{t.addEventListener("click",o=>{o.target===t&&l(t.id)})})}function i(t){const o=document.getElementById(t);o&&(document.body.classList.add("modal-open"),o.classList.add("active"))}function l(t){const o=document.getElementById(t);if(o){document.body.classList.remove("modal-open"),o.classList.remove("active");const r=o.querySelector("form");r&&r.reset()}}function m(){const t=document.getElementById("cadastroForm"),o=document.getElementById("loginForm");t&&t.addEventListener("submit",async r=>{r.preventDefault();const s=new FormData(t);try{const e=await(await fetch(`${c}/cadastro.php`,{method:"POST",body:s})).text();console.log("Resposta bruta:",e);const n=JSON.parse(e);alert(n.message),n.success&&(l("cadastroModal"),i("loginModal"))}catch(a){console.error("Erro ao interpretar JSON:",a),alert("Erro inesperado no cadastro")}}),o&&o.addEventListener("submit",async r=>{r.preventDefault();const s={usuario:document.getElementById("loginUsuario").value.trim(),senha:document.getElementById("loginSenha").value};try{const e=await(await fetch(`${c}/login.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();alert(e.message),e.success&&(localStorage.setItem("sessao_token",e.token),localStorage.setItem("usuarioLogado",JSON.stringify(e.usuario)),l("loginModal"),d(e.usuario),i("bemVindoModal"))}catch(a){console.error("Erro no login:",a),alert("Erro inesperado ao fazer login")}})}function d(t=null){const o=t||JSON.parse(localStorage.getItem("usuarioLogado")),r=document.querySelector("#menu-principal");if(!r)return;if(r.querySelectorAll('[data-modal="loginModal"], [data-modal="cadastroModal"]').forEach(e=>{e&&e.parentElement&&e.parentElement.remove()}),r.querySelectorAll(".usuario-logado").forEach(e=>e.parentElement.remove()),!o){const e=document.createElement("li");e.innerHTML='<a href="#" data-modal="loginModal" class="botao">Entrar</a>',r.appendChild(e);const n=document.createElement("li");n.innerHTML='<a href="#" data-modal="cadastroModal" class="botao destaque">Cadastrar</a>',r.appendChild(n),u();return}const s=o!=null&&o.apelido&&o.apelido.trim()!==""?o.apelido:o.nome,a=document.createElement("li");a.innerHTML=`
  <span class="usuario-logado">Olá, <strong>${s}</strong>!</span>
  <a href="#" class="botao destaque" id="logoutBtn">Sair</a>
`,r.appendChild(a),document.getElementById("logoutBtn").addEventListener("click",async e=>{e.preventDefault(),await g()})}async function f(){const t=localStorage.getItem("sessao_token");if(t)try{const r=await(await fetch(`${c}/verificar_sessao.php`,{method:"GET",headers:{Authorization:t}})).json();r.success?d(r.usuario):(localStorage.removeItem("sessao_token"),localStorage.removeItem("usuarioLogado"),d())}catch(o){console.error("Erro ao verificar sessão:",o),localStorage.removeItem("sessao_token"),localStorage.removeItem("usuarioLogado")}}async function g(){const t=localStorage.getItem("sessao_token");if(!t){localStorage.removeItem("usuarioLogado"),location.reload();return}try{await fetch(`${c}/logout.php`,{method:"POST",headers:{Authorization:t}})}catch(o){console.error("Erro ao fazer logout:",o)}finally{localStorage.removeItem("sessao_token"),localStorage.removeItem("usuarioLogado"),location.reload()}}
